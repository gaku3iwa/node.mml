{"version":3,"file":"mml_bundle.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAa,IAAID,IAEjBD,EAAU,IAAIC,IARhB,CASGK,MAAM,WACT,M,mBCTA,IAAIC,EAAsB,CCA1BA,EAAwB,CAACL,EAASM,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3EF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFT,EAAyBL,IACH,oBAAXkB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeV,EAASkB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeV,EAAS,aAAc,CAAEoB,OAAO,M,4DCEvD,MAeMC,EAAQ,CAACC,EAAOC,IAAY,GAAKD,GAAU,EAAIC,GAO/CC,EAAQC,GAAQ,IAAMC,KAAKC,IAAI,GAAIF,EAAM,IAAM,IAQ/CG,EAAK,CACT,CAEoB,KAAMJ,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,K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","sources":["webpack://mml/webpack/universalModuleDefinition","webpack://mml/webpack/bootstrap","webpack://mml/webpack/runtime/define property getters","webpack://mml/webpack/runtime/hasOwnProperty shorthand","webpack://mml/webpack/runtime/make namespace object","webpack://mml/./src/_define.js","webpack://mml/./src/_parser.js","webpack://mml/./src/_assemble.js","webpack://mml/./src/_play.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"mml\"] = factory();\n\telse\n\t\troot[\"mml\"] = factory();\n})(this, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// ============================================================================\n// _define.js\n// Copyright © 2021- gaku.iwa All Rights Reserved.\n// ============================================================================\n\n// ----------------------------------------------------------------------------\n// 下限値、上限値、規定値 他\nconst rest = `r `;\nconst T = { min:   1, max: 480, def: 120, };\nconst V = { min:   0, max:  15, def:  10, };\nconst P = { min:  -8, max:  +8, def:   0, center: 0, left: -8, right: +8, };\nconst O = { min:   1, max:   9, def:   4, };\nconst Q = { min:   1, max:   8, def:   8, };\n\n// ----------------------------------------------------------------------------\n// 秒数へ変換\n// ----------------------------------------------------------------------------\n// テンポと音長から秒数を算出する\n// ex.) 「toSEC(120, 4)」=> 0.5[sec]を返却します\n//      「t120 c4」\n//        =>  １分間に４分音符120個分の速さで「ド」を４分音符の長さで鳴らす\n//            Web Audio APIには、具体的な「秒数指定」が必要なので…\nconst toSEC = (tempo, length) => (60 / tempo) * (4 / length);\n\n// ----------------------------------------------------------------------------\n// 周波数へ変換\n// ----------------------------------------------------------------------------\n// num = 69（o5 a => 440Hz）を基準に平均律の周波数値へ変換する\n// => 平均律は１オクターブを12等分した音階のこと\nconst toHz = (num) => 440 * Math.pow(2, (num - 69) / 12);\n\n// ----------------------------------------------------------------------------\n// 音階テーブル（「o5 a」=> 440Hzが基準）\n// ----------------------------------------------------------------------------\n// ex.1) 「o4 a-」=> nn[4][\"a-\"] を指定する\n// ex.2) 「o5 a 」=> nn[5][\"a \"] を指定する\n// ex.3) 「o6 a#」=> nn[6][\"a#\"] を指定する\nconst nn = [\n  {\n    // o0\n                      \"d-\": toHz(0x01), \"e-\": toHz(0x03), \"f-\": toHz(0x04), \"g-\": toHz(0x06), \"a-\": toHz(0x08), \"b-\": toHz(0x0a), // 10\n    \"c \": toHz(0x00), \"d \": toHz(0x02), \"e \": toHz(0x04), \"f \": toHz(0x05), \"g \": toHz(0x07), \"a \": toHz(0x09), \"b \": toHz(0x0b), // 11\n    \"c#\": toHz(0x01), \"d#\": toHz(0x03), \"e#\": toHz(0x05), \"f#\": toHz(0x06), \"g#\": toHz(0x08), \"a#\": toHz(0x0a), \"b#\": toHz(0x0c), // 12\n  },\n  {\n    // o1\n    \"c-\": toHz(0x0b), \"d-\": toHz(0x0d), \"e-\": toHz(0x0f), \"f-\": toHz(0x10), \"g-\": toHz(0x12), \"a-\": toHz(0x14), \"b-\": toHz(0x16), // 22\n    \"c \": toHz(0x0c), \"d \": toHz(0x0e), \"e \": toHz(0x10), \"f \": toHz(0x11), \"g \": toHz(0x13), \"a \": toHz(0x15), \"b \": toHz(0x17), // 23\n    \"c#\": toHz(0x0d), \"d#\": toHz(0x0f), \"e#\": toHz(0x11), \"f#\": toHz(0x12), \"g#\": toHz(0x14), \"a#\": toHz(0x16), \"b#\": toHz(0x18), // 24\n  },\n  {\n    // o2\n    \"c-\": toHz(0x17), \"d-\": toHz(0x19), \"e-\": toHz(0x1b), \"f-\": toHz(0x1c), \"g-\": toHz(0x1e), \"a-\": toHz(0x20), \"b-\": toHz(0x22), // 34\n    \"c \": toHz(0x18), \"d \": toHz(0x1a), \"e \": toHz(0x1c), \"f \": toHz(0x1d), \"g \": toHz(0x1f), \"a \": toHz(0x21), \"b \": toHz(0x23), // 35\n    \"c#\": toHz(0x19), \"d#\": toHz(0x1b), \"e#\": toHz(0x1d), \"f#\": toHz(0x1e), \"g#\": toHz(0x20), \"a#\": toHz(0x22), \"b#\": toHz(0x24), // 36\n  },\n  {\n    // o3\n    \"c-\": toHz(0x23), \"d-\": toHz(0x25), \"e-\": toHz(0x27), \"f-\": toHz(0x28), \"g-\": toHz(0x2a), \"a-\": toHz(0x2c), \"b-\": toHz(0x2e), // 46\n    \"c \": toHz(0x24), \"d \": toHz(0x26), \"e \": toHz(0x28), \"f \": toHz(0x29), \"g \": toHz(0x2b), \"a \": toHz(0x2d), \"b \": toHz(0x2f), // 47\n    \"c#\": toHz(0x25), \"d#\": toHz(0x27), \"e#\": toHz(0x29), \"f#\": toHz(0x2a), \"g#\": toHz(0x2c), \"a#\": toHz(0x2e), \"b#\": toHz(0x30), // 48\n  },\n  {\n    // o4\n    \"c-\": toHz(0x2f), \"d-\": toHz(0x31), \"e-\": toHz(0x33), \"f-\": toHz(0x34), \"g-\": toHz(0x36), \"a-\": toHz(0x38), \"b-\": toHz(0x3a), // 58\n    \"c \": toHz(0x30), \"d \": toHz(0x32), \"e \": toHz(0x34), \"f \": toHz(0x35), \"g \": toHz(0x37), \"a \": toHz(0x39), \"b \": toHz(0x3b), // 59\n    \"c#\": toHz(0x31), \"d#\": toHz(0x33), \"e#\": toHz(0x35), \"f#\": toHz(0x36), \"g#\": toHz(0x38), \"a#\": toHz(0x3a), \"b#\": toHz(0x3c), // 60\n  },\n  {\n    // o5\n    \"c-\": toHz(0x3b), \"d-\": toHz(0x3d), \"e-\": toHz(0x3f), \"f-\": toHz(0x40), \"g-\": toHz(0x42), \"a-\": toHz(0x44), \"b-\": toHz(0x46), // 70\n    \"c \": toHz(0x3c), \"d \": toHz(0x3e), \"e \": toHz(0x40), \"f \": toHz(0x41), \"g \": toHz(0x43), \"a \": toHz(0x45), \"b \": toHz(0x47), // 71\n    \"c#\": toHz(0x3d), \"d#\": toHz(0x3f), \"e#\": toHz(0x41), \"f#\": toHz(0x42), \"g#\": toHz(0x44), \"a#\": toHz(0x46), \"b#\": toHz(0x48), // 72\n  },\n  {\n    // o6\n    \"c-\": toHz(0x47), \"d-\": toHz(0x49), \"e-\": toHz(0x4b), \"f-\": toHz(0x4c), \"g-\": toHz(0x4e), \"a-\": toHz(0x50), \"b-\": toHz(0x52), // 82\n    \"c \": toHz(0x48), \"d \": toHz(0x4a), \"e \": toHz(0x4c), \"f \": toHz(0x4d), \"g \": toHz(0x4f), \"a \": toHz(0x51), \"b \": toHz(0x53), // 83\n    \"c#\": toHz(0x49), \"d#\": toHz(0x4b), \"e#\": toHz(0x4d), \"f#\": toHz(0x4e), \"g#\": toHz(0x50), \"a#\": toHz(0x52), \"b#\": toHz(0x54), // 84\n  },\n  {\n    // o7\n    \"c-\": toHz(0x53), \"d-\": toHz(0x55), \"e-\": toHz(0x57), \"f-\": toHz(0x58), \"g-\": toHz(0x5a), \"a-\": toHz(0x5c), \"b-\": toHz(0x5e), // 94\n    \"c \": toHz(0x54), \"d \": toHz(0x56), \"e \": toHz(0x58), \"f \": toHz(0x59), \"g \": toHz(0x5b), \"a \": toHz(0x5d), \"b \": toHz(0x5f), // 95\n    \"c#\": toHz(0x55), \"d#\": toHz(0x57), \"e#\": toHz(0x59), \"f#\": toHz(0x5a), \"g#\": toHz(0x5c), \"a#\": toHz(0x5e), \"b#\": toHz(0x60), // 96\n  },\n  {\n    // o8\n    \"c-\": toHz(0x5f), \"d-\": toHz(0x61), \"e-\": toHz(0x63), \"f-\": toHz(0x64), \"g-\": toHz(0x66), \"a-\": toHz(0x68), \"b-\": toHz(0x6a), // 106\n    \"c \": toHz(0x60), \"d \": toHz(0x62), \"e \": toHz(0x64), \"f \": toHz(0x65), \"g \": toHz(0x67), \"a \": toHz(0x69), \"b \": toHz(0x6b), // 107\n    \"c#\": toHz(0x61), \"d#\": toHz(0x63), \"e#\": toHz(0x65), \"f#\": toHz(0x66), \"g#\": toHz(0x68), \"a#\": toHz(0x6a), \"b#\": toHz(0x6c), // 108\n  },\n  {\n    // o9\n    \"c-\": toHz(0x6b), \"d-\": toHz(0x6d), \"e-\": toHz(0x6f), \"f-\": toHz(0x70), \"g-\": toHz(0x72), \"a-\": toHz(0x74), \"b-\": toHz(0x76), // 118\n    \"c \": toHz(0x6c), \"d \": toHz(0x6e), \"e \": toHz(0x70), \"f \": toHz(0x71), \"g \": toHz(0x73), \"a \": toHz(0x75), \"b \": toHz(0x77), // 119\n    \"c#\": toHz(0x6d), \"d#\": toHz(0x6f), \"e#\": toHz(0x71), \"f#\": toHz(0x72), \"g#\": toHz(0x74), \"a#\": toHz(0x76), \"b#\": toHz(0x78), // 120\n  },\n  {\n    // o10\n    \"c-\": toHz(0x77), \"d-\": toHz(0x79), \"e-\": toHz(0x7b), \"f-\": toHz(0x7c), \"g-\": toHz(0x7e),\n    \"c \": toHz(0x78), \"d \": toHz(0x7a), \"e \": toHz(0x7c), \"f \": toHz(0x7d), \"g \": toHz(0x7f),\n    \"c#\": toHz(0x79), \"d#\": toHz(0x7b), \"e#\": toHz(0x7d), \"f#\": toHz(0x7e),\n  },\n];\n\nexport { O, P, Q, T, V, nn, rest, toHz, toSEC };\n","// ============================================================================\n// _parser.js\n// Copyright © 2021- gaku.iwa All Rights Reserved.\n// ============================================================================\nimport { O, P, Q, T, V } from \"./_define.js\";\n\n// ----------------------------------------------------------------------------\n// 制御配列を逆順に検索して、制御キーから設定値を取得する\n// ----------------------------------------------------------------------------\n// `t`:テンポ         1 ~ 480\n// `v`:音量           0 ~ 15\n// `!`:一時的な音量   0 ~ 15\n// `p`:パン          -8 ~ 0 ~ +8、左〜中央〜右\n// `o`:オクターブ     1 ~ 9\n// `q`:ゲートタイム   1 ~ 8、スタッカート的な効果\n// `l`:音長\n// `&`:タイ or スラー\nconst search = (ary, chr, def) => {\n  let rtn = { key: chr, value: def, index: -1 };\n  for (var i = ary.length - 1; i >= 0; --i) {\n    if (ary[i].ctrl !== chr) continue;\n    rtn.value = Number(ary[i].param);\n    rtn.index = i;\n    break;\n  }\n  return rtn;\n};\n\n// ----------------------------------------------------------------------------\n// 制御配列と音階データから、Web Audio APIで利用しやすい形式へ変換\nconst convert = (ary, tn) => {\n  const rtn = {\n    t: Math.max(Math.min(search(ary, `t`, T.def).value, T.max), T.min),\n    v: Math.max(Math.min(search(ary, `v`, V.def).value, V.max), V.min),\n    p: Math.max(Math.min(search(ary, `p`, P.def).value, P.max), P.min),\n    o: Math.max(Math.min(search(ary, `o`, O.def).value, O.max), O.min),\n    q: Math.max(Math.min(search(ary, `q`, Q.def).value, Q.max), Q.min),\n    tn: `c`,\n    l: `4`,\n    j: 0,\n  };\n\n  // --------------------------------------------------------------------------\n  // 音階指定の前に一時的な音量指定があった場合\n  // 判定後、一時的な指定音量へ変更し、制御配列から取り除く\n  let v = search(ary, `!`, V.def);\n  if (v.index !== -1) {\n    rtn.v = Math.max(Math.min(v.value, V.max), V.min);\n    ary.splice(v.index, 1);\n  }\n\n  // --------------------------------------------------------------------------\n  // 音階指定の前にタイorスラー指定があった場合\n  // 判定後、jointフラグを立てて、制御配列から取り除く\n  let j = search(ary, `&`, rtn.j);\n  rtn.j = Math.max(Math.min(j.value, 1), 0);\n  if (rtn.j === 1) {\n    ary.splice(j.index, 1);\n  }\n\n  // --------------------------------------------------------------------------\n  // 音長\n  let l = search(ary, `l`, rtn.l);\n  rtn.l = tn.len === `` ? l.value.toString() : tn.len === `.` ? l.value.toString() + `.` : tn.len;\n\n  // --------------------------------------------------------------------------\n  // 音階\n  rtn.tn = (tn.tone + `  `).slice(0, 2);\n  return rtn;\n};\n\n// ----------------------------------------------------------------------------\n// MMLパーサー\nconst parser = (mml_part) => {\n  const parser_result = [];\n  mml_part.forEach((mml) => {\n    let tmp = { ctrl: ``, param: ``, tone: ``, len: `` };\n    let dmy = JSON.parse(JSON.stringify(tmp));\n    let ctrlAry = [];\n    let toneAry = [];\n\n    // ------------------------------------------------------------------------\n    // ひと文字ずつ読み込んで、\n    // 制御配列（ctrlAry） or 音階配列（toneAry）へ積み込む\n    Array.prototype.forEach.call(mml, (item) => {\n      const chr = item.toLowerCase();\n      switch (chr) {\n        case `t`:\n        case `v`:\n        case `p`:\n        case `o`:\n        case `l`:\n        case `q`:\n        case `>`:\n        case `<`:\n        case `!`:\n          if (dmy.ctrl !== chr || dmy.tone !== chr) {\n            if (dmy.ctrl !== ``) ctrlAry.push(dmy);\n            if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\n            dmy = JSON.parse(JSON.stringify(tmp));\n          }\n          switch (chr) {\n            case `t`: // テンポ\n              dmy.ctrl = `t`;\n              break;\n            case `v`: // 音量\n              dmy.ctrl = `v`;\n              break;\n            case `p`: // パン\n              dmy.ctrl = `p`;\n              break;\n            case `o`: // 音階\n              dmy.ctrl = `o`;\n              break;\n            case `q`: // ゲートタイム\n              dmy.ctrl = `q`;\n              break;\n            case `l`: // 音長\n              dmy.ctrl = `l`;\n              break;\n            case `>`: // オクターブ上げ\n              {\n                let o = search(ctrlAry, `o`, 4);\n                dmy.ctrl = o.key;\n                dmy.param = (o.value + 1).toString();\n              }\n              break;\n            case `<`: // オクターブ下げ\n              {\n                let o = search(ctrlAry, `o`, 4);\n                dmy.ctrl = o.key;\n                dmy.param = (o.value - 1).toString();\n              }\n              break;\n            case `!`: // 一時的な音量\n              dmy.ctrl = `!`;\n              break;\n          }\n          break;\n\n        case `&`: // タイ or スラー\n          if (dmy.ctrl !== chr || dmy.tone !== chr) {\n            if (dmy.ctrl !== ``) ctrlAry.push(dmy);\n            if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\n            dmy = JSON.parse(JSON.stringify(tmp));\n            dmy.ctrl = `&`;\n            dmy.param = `1`;\n          }\n          break;\n\n        case `r`: // 休符\n        case `a`: // 音階 ラ\n        case `b`: // 音階 シ\n        case `c`: // 音階 ド\n        case `d`: // 音階 レ\n        case `e`: // 音階 ミ\n        case `f`: // 音階 ファ\n        case `g`: // 音階 ソ\n          if (dmy.ctrl !== chr || dmy.tone !== chr) {\n            if (dmy.ctrl !== ``) ctrlAry.push(dmy);\n            if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\n            dmy = JSON.parse(JSON.stringify(tmp));\n          }\n          dmy.tone += chr;\n          break;\n\n        case `-`: // 半音サゲ or 負パラメータ\n        case `+`: // 半音アゲ or 正パラメータ\n        case `#`: // 半音アゲ ← 音階の後の記述のみ有効\n          if (dmy.tone.length === 1 && `a` <= dmy.tone && dmy.tone <= `g`) {\n            dmy.tone += chr;\n          }\n          if (dmy.ctrl === `p` && (chr === `-` || chr === `+`)) {\n            dmy.param += chr;\n          }\n          break;\n\n        case `.`: // 付点←連続した付点（二重、三重）は、２個目以降は無視\n          if (dmy.tone !== `` && !dmy.len.includes(`.`)) {\n            dmy.len += chr;\n          }\n          break;\n\n        case `0`:\n        case `1`:\n        case `2`:\n        case `3`:\n        case `4`:\n        case `5`:\n        case `6`:\n        case `7`:\n        case `8`:\n        case `9`:\n          if (dmy.ctrl !== ``) dmy.param += chr;\n          if (dmy.tone !== ``) dmy.len += chr;\n          break;\n\n        default: // 無視\n      }\n    });\n\n    // ------------------------------------------------------------------------\n    // 最後の要素を積み込んでいないので、\n    // 制御配列（ctrlAry） or 音階配列（toneAry）へ積み込む\n    if (dmy.ctrl !== ``) ctrlAry.push(dmy);\n    if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\n\n    // ------------------------------------------------------------------------\n    // １音ずつの音階配列から「＆」による音の結合を考慮して、\n    // 音量、パンポット、オクターブ、音長、音階を配列化する\n    // テンポとゲートタイムは、結合前の指定値を採用する\n    let tmpAry = [];\n    for (let loop = 0; loop < toneAry.length; ++loop) {\n      let rtn = {\n        t: toneAry[loop].t,\n        q: toneAry[loop].q,\n        v: [],\n        p: [],\n        o: [],\n        l: [],\n        tn: [],\n      };\n      if (toneAry[loop].j === 1) {\n        // ＆記号あり、前要素からの延長\n        if (0 < tmpAry.length) {\n          rtn = tmpAry[tmpAry.length - 1];\n          rtn.v.push(toneAry[loop].v);\n          rtn.p.push(toneAry[loop].p);\n          rtn.o.push(toneAry[loop].o);\n          rtn.l.push(toneAry[loop].l);\n          rtn.tn.push(toneAry[loop].tn);\n        } else {\n          rtn.v.push(toneAry[loop].v);\n          rtn.p.push(toneAry[loop].p);\n          rtn.o.push(toneAry[loop].o);\n          rtn.l.push(toneAry[loop].l);\n          rtn.tn.push(toneAry[loop].tn);\n          tmpAry.push(rtn);\n        }\n      } else {\n        // ＆記号なし、新要素として追加\n        rtn.v.push(toneAry[loop].v);\n        rtn.p.push(toneAry[loop].p);\n        rtn.o.push(toneAry[loop].o);\n        rtn.l.push(toneAry[loop].l);\n        rtn.tn.push(toneAry[loop].tn);\n        tmpAry.push(rtn);\n      }\n    }\n\n    // // ------------------------------------------------------------------------\n    // // デバッグログ\n    // tmpAry.forEach((x) => {\n    //   console.log(`t${(\"   \" + x.t.toString()).slice(-3)} v[${x.v}] p[${x.p}] | o[${x.o}][${x.tn}][${x.q}][${x.l}]`);\n    // });\n    // console.log(\"-\".repeat(40));\n\n    // ------------------------------------------------------------------------\n    // パース結果をパート配列へ\n    let part = {};\n    part.toneAry = tmpAry;\n    parser_result.push(part);\n  });\n  return parser_result;\n};\n\nexport { parser };\n","// ============================================================================\n// _assemble.js\n// Copyright © 2021- gaku.iwa All Rights Reserved.\n// ============================================================================\nimport { P, Q, V, nn, rest, toSEC } from \"./_define.js\";\n\n// ----------------------------------------------------------------------------\n// 音階配列からWeb Audio APIの組み立て\n// ----------------------------------------------------------------------------\n//  < part >\n//  +-------+    +-------+    +-------+\n//  | osciN | -> | gainN | -> | panrN | -+\n//  +-------+    +-------+    +-------+  |   +--------------+    +-----+\n//                                       +-> | master(gain) | -> | dst |\n//  +-------+    +-------+    +-------+  |   +--------------+    +-----+\n//  | osciN | -> | gainN | -> | panrN | -+\n//  +-------+    +-------+    +-------+\n//\nconst assemble = (parse_result) => {\n  const aux = new AudioContext();\n  const dst = aux.destination;\n  const ctx = dst.context;\n  const ary = [];\n  const tm_start = aux.currentTime;\n  // --------------------------------------------------------------------------\n  // MMLパーサー処理結果をパート毎にループ処理\n  parse_result.forEach((part) => {\n    const osciN = ctx.createOscillator();\n    const gainN = ctx.createGain();\n    const panrN = ctx.createStereoPanner();\n    let Timing = tm_start;\n\n    // ------------------------------------------------------------------------\n    // パートの音階配列を１音毎にループ処理\n    part.toneAry.forEach((tn) => {\n      let fullTime = 0;\n      let gateTime = 0;\n\n      // ----------------------------------------------------------------------\n      // 休符、音符 -> osciN\n      // 音量       -> gainN\n      // パン       -> panrN\n      if (tn.tn[0] === rest) {\n        osciN.frequency.setValueAtTime(0, Timing);\n        gainN.gain.setValueAtTime(0, Timing);\n        panrN.pan.setValueAtTime(0, Timing);\n\n        // --------------------------------------------------------------------\n        // 休符の場合、ゲートタイムを上限値に上書きする\n        tn.q = Q.max;\n\n        // --------------------------------------------------------------------\n        // 音長配列（付点なし、付点あり）=> 次の発音タイミング計算\n        tn.l.forEach((ln) => {\n          if (!ln.includes(`.`)) {\n            let tm = Number(ln);\n            fullTime += toSEC(tn.t, tm);\n          } else {\n            let tm = Number(ln.replace(`.`, ``));\n            fullTime += toSEC(tn.t, tm) + toSEC(tn.t, tm * 2);\n          }\n        });\n\n        // --------------------------------------------------------------------\n        // ゲートタイム（スタッカート）の音長計算\n        gateTime = (fullTime * tn.q) / Q.max; // <= ゲートタイムを加味\n        Timing += gateTime;\n      } else {\n        let subTiming = Timing;\n        let subgateTime = 0;\n\n        for (let idx = 0; idx < tn.tn.length; ++idx) {\n          if (idx === 0) {\n            // ----------------------------------------------------------------\n            // 発音時点の音量\n            let gval = Math.cos((1 - tn.v[idx] / V.max) * 0.5 * Math.PI);\n            gainN.gain.setValueAtTime(gval, subTiming);\n            // ----------------------------------------------------------------\n            // 発音時点のパンポット\n            let pval = tn.p[idx] / P.max;\n            panrN.pan.setValueAtTime(pval, subTiming);\n            // ----------------------------------------------------------------\n            // 発音時点の音階（周波数）\n            let freq = nn[tn.o[idx]][tn.tn[idx].replace(`+`, `#`)];\n            osciN.frequency.setValueAtTime(freq, subTiming);\n          }\n\n          // ------------------------------------------------------------------\n          // 音長配列（付点なし、付点あり）=> 次の発音タイミング計算\n          let ln = tn.l[idx];\n          if (!ln.includes(`.`)) {\n            let tm = Number(ln);\n            subgateTime = toSEC(tn.t, tm);\n          } else {\n            let tm = Number(ln.replace(`.`, ``));\n            subgateTime = toSEC(tn.t, tm) + toSEC(tn.t, tm * 2);\n          }\n          subTiming += subgateTime;\n\n          // ------------------------------------------------------------------\n          // 音階配列に複数の値が入っている場合、\n          // 音量、パンポット、タイ or スラーの処理\n          if (1 < tn.tn.length && idx !== tn.tn.length - 1) {\n            // 音量\n            let gval = Math.sin((tn.v[idx + 1] / V.max) * 0.5 * Math.PI);\n            gainN.gain.linearRampToValueAtTime(gval, subTiming);\n            // パンポット\n            let pval = tn.p[idx + 1] / P.max;\n            panrN.pan.linearRampToValueAtTime(pval, subTiming);\n            // 音階\n            let freq = nn[tn.o[idx + 1]][tn.tn[idx + 1].replace(`+`, `#`)];\n            osciN.frequency.linearRampToValueAtTime(freq, subTiming);\n          }\n        }\n\n        // --------------------------------------------------------------------\n        // 音長配列（付点なし、付点あり）=> 次の発音タイミング計算\n        tn.l.forEach((ln) => {\n          if (!ln.includes(`.`)) {\n            let tm = Number(ln);\n            fullTime += toSEC(tn.t, tm);\n          } else {\n            let tm = Number(ln.replace(`.`, ``));\n            fullTime += toSEC(tn.t, tm) + toSEC(tn.t, tm * 2);\n          }\n        });\n\n        // --------------------------------------------------------------------\n        // ゲートタイム（スタッカート）の音長計算\n        gateTime = (fullTime * tn.q) / Q.max; // <= ゲートタイムを加味\n        Timing += gateTime;\n\n        // --------------------------------------------------------------------\n        // ADSRの代用\n        // 音量減衰 => 次の発音タイミングまでに半分まで減衰させる\n        if (tn.v.length < 2) {\n          let gval = gainN.gain.value;\n          gainN.gain.linearRampToValueAtTime(gval * 0.5, Timing);\n        }\n      }\n\n      // ----------------------------------------------------------------------\n      // ゲートタイム（スタッカート）=> 次の発音タイミング計算\n      // 次の発音タイミングまでに休符を挟み込んでスタッカートを再現\n      if (tn.q < Q.max) {\n        osciN.frequency.setValueAtTime(0, Timing);\n        gainN.gain.setValueAtTime(0, Timing);\n        panrN.pan.setValueAtTime(0, Timing);\n        Timing += fullTime - gateTime;\n      }\n    });\n    osciN.type = \"square\";\n    osciN.start(tm_start);\n    osciN.stop(Timing);\n\n    // ------------------------------------------------------------------------\n    //  +-------+    +-------+    +-------+      +-------+\n    //  | osciN | -> | gainN | -> | panrN |  =>  |  ary  |\n    //  +-------+    +-------+    +-------+      +-------+\n    osciN.connect(gainN);\n    gainN.connect(panrN);\n    ary.push(panrN);\n  });\n\n  // --------------------------------------------------------------------------\n  //  +-------+      +--------+    +-------+\n  //  |  ary  |  =>  | master | -> |  dst  |\n  //  +-------+      +--------+    +-------+\n  // const master = ctx.createGain();\n  // master.gain.value = 1;\n  // ary.forEach((x) => x.connect(master));\n  // master.connect(dst);\n\n  // --------------------------------------------------------------------------\n  //  +-------+      +-------+\n  //  |  ary  |  =>  |  dst  |\n  //  +-------+      +-------+\n  ary.forEach((x) => x.connect(dst));\n\n  return aux;\n};\n\nexport { assemble };\n","// ============================================================================\n// _play.js\n// Copyright © 2021- gaku.iwa All Rights Reserved.\n// ============================================================================\nimport { parser } from \"./_parser.js\";\nimport { assemble } from \"./_assemble.js\";\n\n// ----------------------------------------------------------------------------\n// MML再生（mml配列インデックス指定）\nconst play = (idx) => {\n  if (mml_data.mml.length - 1 < idx) return;\n  let val = mml_data.mml[idx].part || ``;\n  if (val === ``) return;\n  return assemble(parser(val));\n};\n\nexport { play };\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","toSEC","tempo","length","toHz","num","Math","pow","nn","search","ary","chr","def","rtn","index","i","ctrl","Number","param","convert","tn","t","max","min","v","p","q","l","j","splice","len","toString","tone","slice","parser","mml_part","parser_result","forEach","mml","tmp","dmy","JSON","parse","stringify","ctrlAry","toneAry","Array","item","toLowerCase","push","includes","tmpAry","loop","part","assemble","parse_result","aux","AudioContext","dst","destination","ctx","context","tm_start","currentTime","osciN","createOscillator","gainN","createGain","panrN","createStereoPanner","Timing","fullTime","gateTime","frequency","setValueAtTime","gain","pan","ln","tm","replace","subTiming","subgateTime","idx","gval","cos","PI","pval","freq","sin","linearRampToValueAtTime","type","start","stop","connect","x","play","mml_data","val"],"sourceRoot":""}