{"version":3,"file":"mml_bundle.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAa,IAAID,IAEjBD,EAAU,IAAIC,GACf,CATD,CASGK,MAAM,I,mBCRT,IAAIC,EAAsB,CCA1BA,EAAwB,CAACL,EAASM,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFT,EAAyBL,IACH,oBAAXkB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeV,EAASkB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeV,EAAS,aAAc,CAAEoB,OAAO,GAAO,G,4DCE9D,MAoBMC,EAAQ,CAACC,EAAOC,IAAY,GAAKD,GAAU,EAAIC,GAO/CC,EAAQC,GAAQ,IAAMC,KAAKC,IAAI,GAAIF,EAAM,IAAM,IAU/CG,EAAK,CACT,CAEoB,KAAMJ,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,GAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAEzH,CAEE,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KACvH,KAAMA,EAAK,IAAO,KAAMA,EAAK,IAAO,KAAMA,EAAK,KAAO,KAAMA,EAAK,KAAO,KAAMA,E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","sources":["webpack://mml/webpack/universalModuleDefinition","webpack://mml/webpack/bootstrap","webpack://mml/webpack/runtime/define property getters","webpack://mml/webpack/runtime/hasOwnProperty shorthand","webpack://mml/webpack/runtime/make namespace object","webpack://mml/./src/define.js","webpack://mml/./src/assemble.js","webpack://mml/./src/parser.js","webpack://mml/./src/play.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"mml\"] = factory();\n\telse\n\t\troot[\"mml\"] = factory();\n})(this, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// =============================================================================\r\n// define.js\r\n// Copyright © 2021- gaku.iwa All Rights Reserved.\r\n// =============================================================================\r\n\r\n// -----------------------------------------------------------------------------\r\n// 下限値、上限値、規定値 他\r\nconst rest = `r `;\r\n// prettier-ignore\r\nconst T = { min:  1, max: 480, def: 120 };\r\n// prettier-ignore\r\nconst V = { min:  0, max:  15, def:  10 };\r\n// prettier-ignore\r\nconst P = { min: -8, max:  +8, def:   0, center: 0, left: -8, right: +8 };\r\n// prettier-ignore\r\nconst O = { min:  1, max:   9, def:   4 };\r\n// prettier-ignore\r\nconst Q = { min:  1, max:   8, def:   8 };\r\n\r\n// -----------------------------------------------------------------------------\r\n// 秒数へ変換\r\n// -----------------------------------------------------------------------------\r\n// テンポと音長から秒数を算出する\r\n// ex.) 「toSEC(120, 4)」=> 0.5[sec]を返却します\r\n//      「t120 c4」\r\n//        =>  １分間に４分音符120個分の速さで「ド」を４分音符の長さで鳴らす\r\n//            Web Audio APIには、具体的な「秒数指定」が必要なので…\r\nconst toSEC = (tempo, length) => (60 / tempo) * (4 / length);\r\n\r\n// -----------------------------------------------------------------------------\r\n// 周波数へ変換\r\n// -----------------------------------------------------------------------------\r\n// num = 69（o5 a => 440Hz）を基準に平均律の周波数値へ変換する\r\n// => 平均律は１オクターブを12等分した音階のこと\r\nconst toHz = (num) => 440 * Math.pow(2, (num - 69) / 12);\r\n\r\n// -----------------------------------------------------------------------------\r\n// 音階テーブル（「o5 a」=> 440Hzが基準）\r\n// -----------------------------------------------------------------------------\r\n// ex.1) 「o4 a-」=> nn[4][\"a-\"] を指定する\r\n// ex.2) 「o5 a 」=> nn[5][\"a \"] を指定する\r\n// ex.3) 「o6 a#」=> nn[6][\"a#\"] を指定する\r\n// -----------------------------------------------------------------------------\r\n// prettier-ignore\r\nconst nn = [\r\n  {\r\n    // o0\r\n                      \"d-\": toHz(0x01), \"e-\": toHz(0x03), \"f-\": toHz(0x04), \"g-\": toHz(0x06), \"a-\": toHz(0x08), \"b-\": toHz(0x0a), // 10\r\n    \"c \": toHz(0x00), \"d \": toHz(0x02), \"e \": toHz(0x04), \"f \": toHz(0x05), \"g \": toHz(0x07), \"a \": toHz(0x09), \"b \": toHz(0x0b), // 11\r\n    \"c#\": toHz(0x01), \"d#\": toHz(0x03), \"e#\": toHz(0x05), \"f#\": toHz(0x06), \"g#\": toHz(0x08), \"a#\": toHz(0x0a), \"b#\": toHz(0x0c), // 12\r\n  },\r\n  {\r\n    // o1\r\n    \"c-\": toHz(0x0b), \"d-\": toHz(0x0d), \"e-\": toHz(0x0f), \"f-\": toHz(0x10), \"g-\": toHz(0x12), \"a-\": toHz(0x14), \"b-\": toHz(0x16), // 22\r\n    \"c \": toHz(0x0c), \"d \": toHz(0x0e), \"e \": toHz(0x10), \"f \": toHz(0x11), \"g \": toHz(0x13), \"a \": toHz(0x15), \"b \": toHz(0x17), // 23\r\n    \"c#\": toHz(0x0d), \"d#\": toHz(0x0f), \"e#\": toHz(0x11), \"f#\": toHz(0x12), \"g#\": toHz(0x14), \"a#\": toHz(0x16), \"b#\": toHz(0x18), // 24\r\n  },\r\n  {\r\n    // o2\r\n    \"c-\": toHz(0x17), \"d-\": toHz(0x19), \"e-\": toHz(0x1b), \"f-\": toHz(0x1c), \"g-\": toHz(0x1e), \"a-\": toHz(0x20), \"b-\": toHz(0x22), // 34\r\n    \"c \": toHz(0x18), \"d \": toHz(0x1a), \"e \": toHz(0x1c), \"f \": toHz(0x1d), \"g \": toHz(0x1f), \"a \": toHz(0x21), \"b \": toHz(0x23), // 35\r\n    \"c#\": toHz(0x19), \"d#\": toHz(0x1b), \"e#\": toHz(0x1d), \"f#\": toHz(0x1e), \"g#\": toHz(0x20), \"a#\": toHz(0x22), \"b#\": toHz(0x24), // 36\r\n  },\r\n  {\r\n    // o3\r\n    \"c-\": toHz(0x23), \"d-\": toHz(0x25), \"e-\": toHz(0x27), \"f-\": toHz(0x28), \"g-\": toHz(0x2a), \"a-\": toHz(0x2c), \"b-\": toHz(0x2e), // 46\r\n    \"c \": toHz(0x24), \"d \": toHz(0x26), \"e \": toHz(0x28), \"f \": toHz(0x29), \"g \": toHz(0x2b), \"a \": toHz(0x2d), \"b \": toHz(0x2f), // 47\r\n    \"c#\": toHz(0x25), \"d#\": toHz(0x27), \"e#\": toHz(0x29), \"f#\": toHz(0x2a), \"g#\": toHz(0x2c), \"a#\": toHz(0x2e), \"b#\": toHz(0x30), // 48\r\n  },\r\n  {\r\n    // o4\r\n    \"c-\": toHz(0x2f), \"d-\": toHz(0x31), \"e-\": toHz(0x33), \"f-\": toHz(0x34), \"g-\": toHz(0x36), \"a-\": toHz(0x38), \"b-\": toHz(0x3a), // 58\r\n    \"c \": toHz(0x30), \"d \": toHz(0x32), \"e \": toHz(0x34), \"f \": toHz(0x35), \"g \": toHz(0x37), \"a \": toHz(0x39), \"b \": toHz(0x3b), // 59\r\n    \"c#\": toHz(0x31), \"d#\": toHz(0x33), \"e#\": toHz(0x35), \"f#\": toHz(0x36), \"g#\": toHz(0x38), \"a#\": toHz(0x3a), \"b#\": toHz(0x3c), // 60\r\n  },\r\n  {\r\n    // o5\r\n    \"c-\": toHz(0x3b), \"d-\": toHz(0x3d), \"e-\": toHz(0x3f), \"f-\": toHz(0x40), \"g-\": toHz(0x42), \"a-\": toHz(0x44), \"b-\": toHz(0x46), // 70\r\n    \"c \": toHz(0x3c), \"d \": toHz(0x3e), \"e \": toHz(0x40), \"f \": toHz(0x41), \"g \": toHz(0x43), \"a \": toHz(0x45), \"b \": toHz(0x47), // 71\r\n    \"c#\": toHz(0x3d), \"d#\": toHz(0x3f), \"e#\": toHz(0x41), \"f#\": toHz(0x42), \"g#\": toHz(0x44), \"a#\": toHz(0x46), \"b#\": toHz(0x48), // 72\r\n  },\r\n  {\r\n    // o6\r\n    \"c-\": toHz(0x47), \"d-\": toHz(0x49), \"e-\": toHz(0x4b), \"f-\": toHz(0x4c), \"g-\": toHz(0x4e), \"a-\": toHz(0x50), \"b-\": toHz(0x52), // 82\r\n    \"c \": toHz(0x48), \"d \": toHz(0x4a), \"e \": toHz(0x4c), \"f \": toHz(0x4d), \"g \": toHz(0x4f), \"a \": toHz(0x51), \"b \": toHz(0x53), // 83\r\n    \"c#\": toHz(0x49), \"d#\": toHz(0x4b), \"e#\": toHz(0x4d), \"f#\": toHz(0x4e), \"g#\": toHz(0x50), \"a#\": toHz(0x52), \"b#\": toHz(0x54), // 84\r\n  },\r\n  {\r\n    // o7\r\n    \"c-\": toHz(0x53), \"d-\": toHz(0x55), \"e-\": toHz(0x57), \"f-\": toHz(0x58), \"g-\": toHz(0x5a), \"a-\": toHz(0x5c), \"b-\": toHz(0x5e), // 94\r\n    \"c \": toHz(0x54), \"d \": toHz(0x56), \"e \": toHz(0x58), \"f \": toHz(0x59), \"g \": toHz(0x5b), \"a \": toHz(0x5d), \"b \": toHz(0x5f), // 95\r\n    \"c#\": toHz(0x55), \"d#\": toHz(0x57), \"e#\": toHz(0x59), \"f#\": toHz(0x5a), \"g#\": toHz(0x5c), \"a#\": toHz(0x5e), \"b#\": toHz(0x60), // 96\r\n  },\r\n  {\r\n    // o8\r\n    \"c-\": toHz(0x5f), \"d-\": toHz(0x61), \"e-\": toHz(0x63), \"f-\": toHz(0x64), \"g-\": toHz(0x66), \"a-\": toHz(0x68), \"b-\": toHz(0x6a), // 106\r\n    \"c \": toHz(0x60), \"d \": toHz(0x62), \"e \": toHz(0x64), \"f \": toHz(0x65), \"g \": toHz(0x67), \"a \": toHz(0x69), \"b \": toHz(0x6b), // 107\r\n    \"c#\": toHz(0x61), \"d#\": toHz(0x63), \"e#\": toHz(0x65), \"f#\": toHz(0x66), \"g#\": toHz(0x68), \"a#\": toHz(0x6a), \"b#\": toHz(0x6c), // 108\r\n  },\r\n  {\r\n    // o9\r\n    \"c-\": toHz(0x6b), \"d-\": toHz(0x6d), \"e-\": toHz(0x6f), \"f-\": toHz(0x70), \"g-\": toHz(0x72), \"a-\": toHz(0x74), \"b-\": toHz(0x76), // 118\r\n    \"c \": toHz(0x6c), \"d \": toHz(0x6e), \"e \": toHz(0x70), \"f \": toHz(0x71), \"g \": toHz(0x73), \"a \": toHz(0x75), \"b \": toHz(0x77), // 119\r\n    \"c#\": toHz(0x6d), \"d#\": toHz(0x6f), \"e#\": toHz(0x71), \"f#\": toHz(0x72), \"g#\": toHz(0x74), \"a#\": toHz(0x76), \"b#\": toHz(0x78), // 120\r\n  },\r\n  {\r\n    // o10\r\n    \"c-\": toHz(0x77), \"d-\": toHz(0x79), \"e-\": toHz(0x7b), \"f-\": toHz(0x7c), \"g-\": toHz(0x7e),\r\n    \"c \": toHz(0x78), \"d \": toHz(0x7a), \"e \": toHz(0x7c), \"f \": toHz(0x7d), \"g \": toHz(0x7f),\r\n    \"c#\": toHz(0x79), \"d#\": toHz(0x7b), \"e#\": toHz(0x7d), \"f#\": toHz(0x7e),\r\n  },\r\n];\r\n\r\nexport { O, P, Q, T, V, nn, rest, toHz, toSEC };\r\n","// =============================================================================\r\n// assemble.js\r\n// Copyright © 2021- gaku.iwa All Rights Reserved.\r\n// =============================================================================\r\nimport { P, Q, V, nn, rest, toSEC } from \"./define.js\";\r\n\r\n// -----------------------------------------------------------------------------\r\n// LFOパラメータの分解、Web Audio APIで利用しやすい形式へ変換\r\nconst parserLFO = (strParam, tempo, def_gatetime) => {\r\n  const rtn = {\r\n    type: 0,\r\n\r\n    v_gateTime: 0,\r\n    v_depth: 0,\r\n    v_speed: 0,\r\n\r\n    t_gateTime: 0,\r\n    t_depth: 0,\r\n    t_speed: 0,\r\n  };\r\n\r\n  if (strParam.length < 1) {\r\n    return rtn;\r\n  }\r\n\r\n  let ary = strParam.split(`/`) || ``;\r\n  if (ary.length === 3 || ary.length === 4) {\r\n    //  揺らぎ効果のタイプ\r\n    rtn.type = Number(ary[0]);\r\n\r\n    switch (rtn.type) {\r\n      case 1:\r\n        {\r\n          let speed = Number(ary[1]);\r\n          let depth = Number(ary[2]);\r\n          let ln = ary.length === 4 ? ary[3] || def_gatetime : def_gatetime;\r\n\r\n          //  揺らぎ効果の深さ\r\n          rtn.v_depth = depth;\r\n\r\n          //  揺らぎ効果の音長\r\n          if (!ln.includes(`.`)) {\r\n            let tm = Number(ln);\r\n            rtn.v_gateTime = toSEC(tempo, tm);\r\n          } else {\r\n            let tm = Number(ln.replace(`.`, ``));\r\n            rtn.v_gateTime = toSEC(tempo, tm) + toSEC(tempo, tm * 2);\r\n          }\r\n\r\n          //  揺らぎ効果の回数\r\n          rtn.v_speed = speed / rtn.v_gateTime;\r\n        }\r\n        break;\r\n\r\n      case 2:\r\n        {\r\n          let speed = Number(ary[1]);\r\n          let depth = Number(ary[2]) / 100.0;\r\n          let ln = ary.length === 4 ? ary[3] || def_gatetime : def_gatetime;\r\n\r\n          //  揺らぎ効果の深さ\r\n          rtn.t_depth = depth;\r\n\r\n          //  揺らぎ効果の音長\r\n          if (!ln.includes(`.`)) {\r\n            let tm = Number(ln);\r\n            rtn.t_gateTime = toSEC(tempo, tm);\r\n          } else {\r\n            let tm = Number(ln.replace(`.`, ``));\r\n            rtn.t_gateTime = toSEC(tempo, tm) + toSEC(tempo, tm * 2);\r\n          }\r\n\r\n          //  揺らぎ効果の回数\r\n          rtn.t_speed = speed / rtn.t_gateTime;\r\n        }\r\n        break;\r\n    }\r\n  } else if (ary.length === 6 || ary.length === 7) {\r\n    //  揺らぎ効果のタイプ\r\n    rtn.type = Number(ary[0]);\r\n\r\n    switch (rtn.type) {\r\n      case 3:\r\n        {\r\n          let speed = Number(ary[1]);\r\n          let depth = Number(ary[2]);\r\n          let ln = ary[3] || def_gatetime;\r\n\r\n          //  揺らぎ効果の深さ\r\n          rtn.v_depth = depth;\r\n\r\n          //  揺らぎ効果の音長\r\n          if (!ln.includes(`.`)) {\r\n            let tm = Number(ln);\r\n            rtn.v_gateTime = toSEC(tempo, tm);\r\n          } else {\r\n            let tm = Number(ln.replace(`.`, ``));\r\n            rtn.v_gateTime = toSEC(tempo, tm) + toSEC(tempo, tm * 2);\r\n          }\r\n\r\n          //  揺らぎ効果の回数\r\n          rtn.v_speed = speed / rtn.v_gateTime;\r\n        }\r\n        {\r\n          let speed = Number(ary[4]);\r\n          let depth = Number(ary[5]) / 100.0;\r\n          let ln = ary.length === 7 ? ary[6] || def_gatetime : def_gatetime;\r\n\r\n          //  揺らぎ効果の深さ\r\n          rtn.t_depth = depth;\r\n\r\n          //  揺らぎ効果の音長\r\n          if (!ln.includes(`.`)) {\r\n            let tm = Number(ln);\r\n            rtn.t_gateTime = toSEC(tempo, tm);\r\n          } else {\r\n            let tm = Number(ln.replace(`.`, ``));\r\n            rtn.t_gateTime = toSEC(tempo, tm) + toSEC(tempo, tm * 2);\r\n          }\r\n\r\n          //  揺らぎ効果の回数\r\n          rtn.t_speed = speed / rtn.t_gateTime;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  return rtn;\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\n// 音階配列からWeb Audio APIの組み立て\r\n// -----------------------------------------------------------------------------\r\n//  < part >\r\n//  +-------+    +-------+    +-------+\r\n//  | osciN | -> | gainN | -> | panrN | -+\r\n//  +-------+    +-------+    +-------+  |   +--------------+    +-----+\r\n//                                       +-> | master(gain) | -> | dst |\r\n//  +-------+    +-------+    +-------+  |   +--------------+    +-----+\r\n//  | osciN | -> | gainN | -> | panrN | -+\r\n//  +-------+    +-------+    +-------+\r\n//\r\nconst assemble = (parse_result) => {\r\n  const aux = new AudioContext();\r\n  const dst = aux.destination;\r\n  const ctx = dst.context;\r\n  const ary = [];\r\n  const tm_zero = aux.currentTime;\r\n  const tm_start = tm_zero;\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // MMLパーサー処理結果をパート毎にループ処理\r\n  parse_result.forEach((part) => {\r\n    // -------------------------------------------------------------------------\r\n    // Tone Node インスタンス化\r\n    const osc = ctx.createOscillator();\r\n    const vol = ctx.createGain();\r\n    const pan = ctx.createStereoPanner();\r\n\r\n    // -------------------------------------------------------------------------\r\n    // 変数初期化\r\n    let Timing = 0; // 全体の演奏時間\r\n\r\n    // -------------------------------------------------------------------------\r\n    // LFO Node インスタンス化\r\n    // -------------------------------------------------------------------------\r\n    // 接続方法が異なるだけなので、１つのインスタンスでビブラート効果と\r\n    // トレモロ効果を切り替える方針で実装したけど…\r\n    // 'setConnectAtTime'みたいな感じで、接続方法を時系列で切り替えできない😱\r\n    // 一晩考えた結果、単純に２つのインスタンスを保持する結論に達しました\r\n\r\n    // -------------------------------------------------------------------------\r\n    // LFO Node for Vibrato\r\n    const v_dep = ctx.createGain();\r\n    v_dep.gain.value = 0;\r\n    v_dep.connect(osc.frequency); // ←周波数に作用\r\n\r\n    const v_lfo = ctx.createOscillator();\r\n    v_lfo.frequency.value = 0;\r\n    v_lfo.connect(v_dep); // ←depthに接続\r\n\r\n    // -------------------------------------------------------------------------\r\n    // LFO Node for Tremolo\r\n    const t_dep = ctx.createGain();\r\n    t_dep.gain.value = 0;\r\n    t_dep.connect(vol.gain); // ←音量に作用\r\n\r\n    const t_lfo = ctx.createOscillator();\r\n    t_lfo.frequency.value = 0;\r\n    t_lfo.connect(t_dep); // ←depthに接続\r\n\r\n    // -------------------------------------------------------------------------\r\n    // パートの音階配列を１音毎にループ処理\r\n    part.toneAry.forEach((tn) => {\r\n      // -----------------------------------------------------------------------\r\n      // 変数初期化\r\n      let fullTime = 0; // 音長全体の時間\r\n      let gateTime = 0; // スタッカートを考慮した発音時間\r\n\r\n      switch (tn.tn[0]) {\r\n        case rest:\r\n          {\r\n            // 休符\r\n            // -----------------------------------------------------------------\r\n            // Tone Node\r\n            osc.frequency.setValueAtTime(0, Timing);\r\n            vol.gain.setValueAtTime(0, Timing);\r\n            pan.pan.setValueAtTime(0, Timing);\r\n\r\n            // -----------------------------------------------------------------\r\n            // LFO Node\r\n            v_dep.gain.setValueAtTime(0, Timing);\r\n            v_lfo.frequency.setValueAtTime(0, Timing);\r\n            t_dep.gain.setValueAtTime(0, Timing);\r\n            t_lfo.frequency.setValueAtTime(0, Timing);\r\n\r\n            // -----------------------------------------------------------------\r\n            // 休符の場合、ゲートタイムを上限値に上書きする\r\n            tn.q = Q.max;\r\n\r\n            // -----------------------------------------------------------------\r\n            // 音長配列（付点なし、付点あり）=> 次の発音タイミング計算\r\n            tn.l.forEach((ln) => {\r\n              if (!ln.includes(`.`)) {\r\n                let tm = Number(ln);\r\n                fullTime += toSEC(tn.t, tm);\r\n              } else {\r\n                let tm = Number(ln.replace(`.`, ``));\r\n                fullTime += toSEC(tn.t, tm) + toSEC(tn.t, tm * 2);\r\n              }\r\n            });\r\n\r\n            // -----------------------------------------------------------------\r\n            // スタッカートのゲートタイム（音長）計算\r\n            gateTime = (fullTime * tn.q) / Q.max; // <= ゲートタイムを加味\r\n            Timing += gateTime;\r\n          }\r\n          break;\r\n\r\n        default:\r\n          {\r\n            // 音符\r\n            // -----------------------------------------------------------------\r\n            // 変数初期化\r\n            let subTiming = Timing;\r\n            let subgateTime = 0;\r\n\r\n            for (let idx = 0; idx < tn.tn.length; ++idx) {\r\n              if (idx === 0) {\r\n                // -------------------------------------------------------------\r\n                // 発音時点の音量\r\n                let val_vol = Math.cos((1 - tn.v[idx] / V.max) * 0.5 * Math.PI);\r\n                vol.gain.setValueAtTime(val_vol, subTiming);\r\n\r\n                // -------------------------------------------------------------\r\n                // 発音時点のパンポット\r\n                let val_pan = tn.p[idx] / P.max;\r\n                pan.pan.setValueAtTime(val_pan, subTiming);\r\n\r\n                // -------------------------------------------------------------\r\n                // 発音時点の音階（周波数）\r\n                let freq = nn[tn.o[idx]][tn.tn[idx].replace(`+`, `#`)];\r\n                osc.frequency.setValueAtTime(freq, subTiming);\r\n\r\n                // -------------------------------------------------------------\r\n                // setting LFO\r\n                let lfo_param = parserLFO(tn.m[idx] || ``, tn.t, tn.l[idx]);\r\n                switch (lfo_param.type) {\r\n                  case 1: // Vibrato\r\n                    {\r\n                      v_dep.gain.setValueAtTime(lfo_param.v_depth, subTiming);\r\n                      v_lfo.frequency.setValueAtTime(lfo_param.v_speed, subTiming);\r\n                      v_dep.gain.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n                      v_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n                    }\r\n                    break;\r\n\r\n                  case 2: // Tremolo\r\n                    {\r\n                      let tmp_depth = val_vol * lfo_param.t_depth;\r\n                      t_dep.gain.setValueAtTime(tmp_depth, subTiming);\r\n                      t_lfo.frequency.setValueAtTime(lfo_param.t_speed, subTiming);\r\n                      t_dep.gain.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                      t_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                    }\r\n                    break;\r\n\r\n                  case 3: // Vibrato & Tremolo\r\n                    {\r\n                      v_dep.gain.setValueAtTime(lfo_param.v_depth, subTiming);\r\n                      v_lfo.frequency.setValueAtTime(lfo_param.v_speed, subTiming);\r\n                      v_dep.gain.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n                      v_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n\r\n                      let tmp_depth = val_vol * lfo_param.t_depth;\r\n                      t_dep.gain.setValueAtTime(tmp_depth, subTiming);\r\n                      t_lfo.frequency.setValueAtTime(lfo_param.t_speed, subTiming);\r\n                      t_dep.gain.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                      t_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                    }\r\n                    break;\r\n\r\n                  default:\r\n                    break;\r\n                }\r\n              }\r\n\r\n              // ---------------------------------------------------------------\r\n              // 音長配列（付点なし、付点あり）=> 次の発音タイミング計算\r\n              let ln = tn.l[idx];\r\n              if (!ln.includes(`.`)) {\r\n                let tm = Number(ln);\r\n                subgateTime = toSEC(tn.t, tm);\r\n              } else {\r\n                let tm = Number(ln.replace(`.`, ``));\r\n                subgateTime = toSEC(tn.t, tm) + toSEC(tn.t, tm * 2);\r\n              }\r\n              subTiming += subgateTime;\r\n\r\n              // ---------------------------------------------------------------\r\n              // 音階配列に複数の値が入っている場合、\r\n              // 音量、パンポット、タイ or スラーの処理\r\n              if (1 < tn.tn.length && idx !== tn.tn.length - 1) {\r\n                // -------------------------------------------------------------\r\n                // 音量\r\n                let val_vol = Math.sin((tn.v[idx + 1] / V.max) * 0.5 * Math.PI);\r\n                vol.gain.linearRampToValueAtTime(val_vol, subTiming);\r\n\r\n                // -------------------------------------------------------------\r\n                // パンポット\r\n                let val_pan = tn.p[idx + 1] / P.max;\r\n                pan.pan.linearRampToValueAtTime(val_pan, subTiming);\r\n\r\n                // -------------------------------------------------------------\r\n                // 音階\r\n                let freq = nn[tn.o[idx + 1]][tn.tn[idx + 1].replace(`+`, `#`)];\r\n                // osc.frequency.linearRampToValueAtTime(freq, subTiming);\r\n                osc.frequency.exponentialRampToValueAtTime(freq, subTiming);\r\n\r\n                // -------------------------------------------------------------\r\n                // setting LFO\r\n                let lfo_param = parserLFO(tn.m[idx + 1] || ``, tn.t, tn.l[idx + 1]);\r\n                switch (lfo_param.type) {\r\n                  case 1: // Vibrato\r\n                    {\r\n                      v_dep.gain.setValueAtTime(lfo_param.v_depth, subTiming);\r\n                      v_lfo.frequency.setValueAtTime(lfo_param.v_speed, subTiming);\r\n                      v_dep.gain.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n                      v_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n                    }\r\n                    break;\r\n\r\n                  case 2: // Tremolo\r\n                    {\r\n                      let tmp_depth = val_vol * lfo_param.t_depth;\r\n                      t_dep.gain.setValueAtTime(tmp_depth, subTiming);\r\n                      t_lfo.frequency.setValueAtTime(lfo_param.t_speed, subTiming);\r\n                      t_dep.gain.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                      t_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                    }\r\n                    break;\r\n\r\n                  case 3: // Vibrato & Tremolo\r\n                    {\r\n                      v_dep.gain.setValueAtTime(lfo_param.v_depth, subTiming);\r\n                      v_lfo.frequency.setValueAtTime(lfo_param.v_speed, subTiming);\r\n                      v_dep.gain.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n                      v_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.v_gateTime);\r\n\r\n                      let tmp_depth = val_vol * lfo_param.t_depth;\r\n                      t_dep.gain.setValueAtTime(tmp_depth, subTiming);\r\n                      t_lfo.frequency.setValueAtTime(lfo_param.t_speed, subTiming);\r\n                      t_dep.gain.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                      t_lfo.frequency.setValueAtTime(0, subTiming + lfo_param.t_gateTime);\r\n                    }\r\n                    break;\r\n\r\n                  default:\r\n                    break;\r\n                }\r\n              }\r\n            }\r\n\r\n            // -----------------------------------------------------------------\r\n            // 音長配列（付点なし、付点あり）=> 次の発音タイミング計算\r\n            tn.l.forEach((ln) => {\r\n              if (!ln.includes(`.`)) {\r\n                let tm = Number(ln);\r\n                fullTime += toSEC(tn.t, tm);\r\n              } else {\r\n                let tm = Number(ln.replace(`.`, ``));\r\n                fullTime += toSEC(tn.t, tm) + toSEC(tn.t, tm * 2);\r\n              }\r\n            });\r\n\r\n            // -----------------------------------------------------------------\r\n            // スタッカートのゲートタイム（音長）計算\r\n            // -----------------------------------------------------------------\r\n            // 例）Ｑ６を指定した場合\r\n            //\r\n            // |-----1-----2-----3-----4-----5-----6-----7-----8\r\n            // |<- fullTime                                  ->|\r\n            // |<- gateTime                      ->|\r\n            //                                     |<- 無 音 ->|\r\n            //                                                 |<- 次の発音タイミング\r\n            gateTime = (fullTime * tn.q) / Q.max;\r\n            Timing += gateTime;\r\n\r\n            // -----------------------------------------------------------------\r\n            // ADSRの代用\r\n            // 音量減衰 => 次の発音タイミングまでに半分まで減衰させる\r\n            if (tn.v.length < 2) {\r\n              let val_vol = vol.gain.value;\r\n              vol.gain.linearRampToValueAtTime(val_vol * 0.5, Timing);\r\n              // vol.gain.exponentialRampToValueAtTime(val_vol * 0.5, Timing);\r\n            }\r\n          }\r\n          break;\r\n      }\r\n\r\n      // -----------------------------------------------------------------------\r\n      // スタッカートの無音時間の加算\r\n      // 一旦発音を止め、演奏全体時間（Timing）を次の発音タイミングまでスキップ\r\n      // -----------------------------------------------------------------------\r\n      // 例）Ｑ６を指定した場合\r\n      //\r\n      // |-----1-----2-----3-----4-----5-----6-----7-----8\r\n      // |<- fullTime                                  ->|\r\n      // |<- gateTime                      ->|\r\n      //                                     |<- 無 音 ->|\r\n      //                                                 |<- 次の発音タイミング\r\n      if (tn.q < Q.max) {\r\n        // ---------------------------------------------------------------------\r\n        // Tone Node\r\n        osc.frequency.setValueAtTime(0, Timing);\r\n        vol.gain.setValueAtTime(0, Timing);\r\n        pan.pan.setValueAtTime(0, Timing);\r\n\r\n        // ---------------------------------------------------------------------\r\n        // LFO Node\r\n        v_dep.gain.setValueAtTime(0, Timing);\r\n        v_lfo.frequency.setValueAtTime(0, Timing);\r\n        t_dep.gain.setValueAtTime(0, Timing);\r\n        t_lfo.frequency.setValueAtTime(0, Timing);\r\n\r\n        // ---------------------------------------------------------------------\r\n        // 無音時間の加算\r\n        Timing += fullTime - gateTime;\r\n      }\r\n    });\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Tone Oscillator\r\n    osc.type = \"square\";\r\n    osc.start(tm_start);\r\n    osc.stop(tm_start + Timing);\r\n\r\n    // -------------------------------------------------------------------------\r\n    // LFO Oscillator for Vibrato\r\n    v_lfo.start(tm_start);\r\n    v_lfo.stop(tm_start + Timing);\r\n\r\n    // -------------------------------------------------------------------------\r\n    // LFO Oscillator for Tremolo\r\n    t_lfo.start(tm_start);\r\n    t_lfo.stop(tm_start + Timing);\r\n\r\n    // -------------------------------------------------------------------------\r\n    //  +-------+    +-------+    +-------+      +-------+\r\n    //  | osciN | -> | gainN | -> | panrN |  =>  |  ary  |\r\n    //  +-------+    +-------+    +-------+      +-------+\r\n    osc.connect(vol);\r\n    vol.connect(pan);\r\n    ary.push(pan);\r\n  });\r\n\r\n  // ---------------------------------------------------------------------------\r\n  //  +-------+      +--------+    +-------+\r\n  //  |  ary  |  =>  | master | -> |  dst  |\r\n  //  +-------+      +--------+    +-------+\r\n  // const master = ctx.createGain();\r\n  // master.gain.value = 1;\r\n  // ary.forEach((x) => x.connect(master));\r\n  // master.connect(dst);\r\n\r\n  // ---------------------------------------------------------------------------\r\n  //  +-------+      +-------+\r\n  //  |  ary  |  =>  |  dst  |\r\n  //  +-------+      +-------+\r\n  ary.forEach((x) => x.connect(dst));\r\n\r\n  return aux;\r\n};\r\n\r\nexport { assemble };\r\n","// =============================================================================\r\n// parser.js\r\n// Copyright © 2021- gaku.iwa All Rights Reserved.\r\n// =============================================================================\r\nimport { O, P, Q, T, V } from \"./define.js\";\r\n\r\n// -----------------------------------------------------------------------------\r\n// 制御配列を逆順に検索して、制御キーから設定値を取得する\r\n// -----------------------------------------------------------------------------\r\n// `t`:テンポ         1 ~ 480\r\n// `v`:音量           0 ~ 15\r\n// `!`:一時的な音量   0 ~ 15\r\n// `p`:パン          -8 ~ 0 ~ +8、左〜中央〜右\r\n// `o`:オクターブ     1 ~ 9\r\n// `q`:ゲートタイム   1 ~ 8、スタッカート的な効果\r\n// `l`:音長\r\n// `&`:タイ or スラー\r\nconst searchCTRL = (ary, chr, def) => {\r\n  let rtn = { key: chr, value: def, index: -1 };\r\n  for (var i = ary.length - 1; i >= 0; --i) {\r\n    if (ary[i].ctrl !== chr) continue;\r\n    rtn.value = Number(ary[i].param);\r\n    rtn.index = i;\r\n    break;\r\n  }\r\n  return rtn;\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\n// 制御配列を逆順に検索して、制御キーから設定値を取得する\r\n// -----------------------------------------------------------------------------\r\n// `m`:LFO\r\nconst searchLFO = (ary, chr) => {\r\n  let rtn = { key: chr, value: ``, index: -1 };\r\n  for (var i = ary.length - 1; i >= 0; --i) {\r\n    if (ary[i].ctrl !== chr) continue;\r\n    rtn.value = ary[i].param;\r\n    rtn.index = i;\r\n    break;\r\n  }\r\n  return rtn;\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\n// 制御配列と音階データから、Web Audio APIで利用しやすい形式へ変換\r\nconst convert = (ary, tn) => {\r\n  const rtn = {\r\n    t: Math.max(Math.min(searchCTRL(ary, `t`, T.def).value, T.max), T.min),\r\n    v: Math.max(Math.min(searchCTRL(ary, `v`, V.def).value, V.max), V.min),\r\n    p: Math.max(Math.min(searchCTRL(ary, `p`, P.def).value, P.max), P.min),\r\n    o: Math.max(Math.min(searchCTRL(ary, `o`, O.def).value, O.max), O.min),\r\n    q: Math.max(Math.min(searchCTRL(ary, `q`, Q.def).value, Q.max), Q.min),\r\n    tn: `c`,\r\n    l: `4`,\r\n    j: 0,\r\n    m: ``,\r\n  };\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // 音階指定の前に一時的な音量指定があった場合\r\n  // 判定後、一時的な指定音量へ変更し、制御配列から取り除く\r\n  let v = searchCTRL(ary, `!`, V.def);\r\n  if (v.index !== -1) {\r\n    rtn.v = Math.max(Math.min(v.value, V.max), V.min);\r\n    ary.splice(v.index, 1);\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // 音階指定の前にタイorスラー指定があった場合\r\n  // 判定後、jointフラグを立てて、制御配列から取り除く\r\n  let j = searchCTRL(ary, `&`, rtn.j);\r\n  rtn.j = Math.max(Math.min(j.value, 1), 0);\r\n  if (rtn.j === 1) {\r\n    ary.splice(j.index, 1);\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // LFO\r\n  // 判定後、制御配列から取り除く\r\n  let m = searchLFO(ary, `m`);\r\n  if (m.index !== -1) {\r\n    rtn.m = m.value;\r\n    ary.splice(m.index, 1);\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // 音長\r\n  let l = searchCTRL(ary, `l`, rtn.l);\r\n  rtn.l = tn.len === `` ? l.value.toString() : tn.len === `.` ? l.value.toString() + `.` : tn.len;\r\n\r\n  // ---------------------------------------------------------------------------\r\n  // 音階\r\n  rtn.tn = (tn.tone + `  `).slice(0, 2);\r\n  return rtn;\r\n};\r\n\r\n// -----------------------------------------------------------------------------\r\n// MMLパーサー\r\nconst parser = (mml_part) => {\r\n  const parser_result = [];\r\n  mml_part.forEach((mml) => {\r\n    let tmp = { ctrl:``, param:``, tone:``, len:``, };\r\n    let dmy = {...tmp};\r\n    let ctrlAry = [];\r\n    let toneAry = [];\r\n\r\n    // -------------------------------------------------------------------------\r\n    // ひと文字ずつ読み込んで、\r\n    // 制御配列（ctrlAry） or 音階配列（toneAry）へ積み込む\r\n    Array.prototype.forEach.call(mml, (item) => {\r\n      const chr = item.toLowerCase();\r\n      switch (chr) {\r\n        case `t`:\r\n        case `v`:\r\n        case `p`:\r\n        case `o`:\r\n        case `l`:\r\n        case `q`:\r\n        case `>`:\r\n        case `<`:\r\n        case `!`:\r\n        case `m`:\r\n          if (dmy.ctrl !== chr || dmy.tone !== chr) {\r\n            if (dmy.ctrl !== ``) ctrlAry.push(dmy);\r\n            if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\r\n            dmy = {...tmp};\r\n          }\r\n          switch (chr) {\r\n            case `t`: // テンポ\r\n              dmy.ctrl = `t`;\r\n              break;\r\n            case `v`: // 音量\r\n              dmy.ctrl = `v`;\r\n              break;\r\n            case `p`: // パン\r\n              dmy.ctrl = `p`;\r\n              break;\r\n            case `o`: // 音階\r\n              dmy.ctrl = `o`;\r\n              break;\r\n            case `q`: // ゲートタイム\r\n              dmy.ctrl = `q`;\r\n              break;\r\n            case `l`: // 音長\r\n              dmy.ctrl = `l`;\r\n              break;\r\n            case `>`: // オクターブ上げ\r\n              {\r\n                let o = searchCTRL(ctrlAry, `o`, 4);\r\n                dmy.ctrl = o.key;\r\n                dmy.param = (o.value + 1).toString();\r\n              }\r\n              break;\r\n            case `<`: // オクターブ下げ\r\n              {\r\n                let o = searchCTRL(ctrlAry, `o`, 4);\r\n                dmy.ctrl = o.key;\r\n                dmy.param = (o.value - 1).toString();\r\n              }\r\n              break;\r\n            case `!`: // 一時的な音量\r\n              dmy.ctrl = `!`;\r\n              break;\r\n            case `m`: // LFO\r\n              dmy.ctrl = `m`;\r\n              break;\r\n          }\r\n          break;\r\n\r\n        case `&`: // タイ or スラー\r\n          if (dmy.ctrl !== chr || dmy.tone !== chr) {\r\n            if (dmy.ctrl !== ``) ctrlAry.push(dmy);\r\n            if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\r\n            dmy = {...tmp};\r\n            dmy.ctrl = `&`;\r\n            dmy.param = `1`;\r\n          }\r\n          break;\r\n\r\n        case `r`: // 休符\r\n        case `a`: // 音階 ラ\r\n        case `b`: // 音階 シ\r\n        case `c`: // 音階 ド\r\n        case `d`: // 音階 レ\r\n        case `e`: // 音階 ミ\r\n        case `f`: // 音階 ファ\r\n        case `g`: // 音階 ソ\r\n          if (dmy.ctrl !== chr || dmy.tone !== chr) {\r\n            if (dmy.ctrl !== ``) ctrlAry.push(dmy);\r\n            if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\r\n            dmy = {...tmp};\r\n          }\r\n          dmy.tone += chr;\r\n          break;\r\n\r\n        case `-`: // 半音サゲ or 負パラメータ\r\n        case `+`: // 半音アゲ or 正パラメータ\r\n        case `#`: // 半音アゲ ← 音階の後の記述のみ有効\r\n          if (dmy.tone.length === 1 && `a` <= dmy.tone && dmy.tone <= `g`) {\r\n            dmy.tone += chr;\r\n          }\r\n          if (dmy.ctrl === `p` && (chr === `-` || chr === `+`)) {\r\n            dmy.param += chr;\r\n          }\r\n          break;\r\n\r\n        case `.`: // 付点←連続した付点（二重、三重）は、２個目以降は無視\r\n                  // LFOパラメータ｜小数値\r\n          if (dmy.ctrl === `m`) dmy.param += chr;\r\n          if (dmy.tone !== `` && !dmy.len.includes(`.`)) {\r\n            dmy.len += chr;\r\n          }\r\n          break;\r\n\r\n        case `/`: // LFOパラメータ｜区切り文字\r\n          if (dmy.ctrl === `m`) dmy.param += chr;\r\n          break;\r\n\r\n        case `0`:\r\n        case `1`:\r\n        case `2`:\r\n        case `3`:\r\n        case `4`:\r\n        case `5`:\r\n        case `6`:\r\n        case `7`:\r\n        case `8`:\r\n        case `9`:\r\n          if (dmy.ctrl !== ``) dmy.param += chr;\r\n          if (dmy.tone !== ``) dmy.len += chr;\r\n          break;\r\n\r\n        default: // 無視\r\n      }\r\n    });\r\n\r\n    // -------------------------------------------------------------------------\r\n    // 最後の要素を積み込んでいないので、\r\n    // 制御配列（ctrlAry） or 音階配列（toneAry）へ積み込む\r\n    if (dmy.ctrl !== ``) ctrlAry.push(dmy);\r\n    if (dmy.tone !== ``) toneAry.push(convert(ctrlAry, dmy));\r\n\r\n    // -------------------------------------------------------------------------\r\n    // １音ずつの音階配列から「＆」による音の結合を考慮して、\r\n    // 音量、パンポット、オクターブ、音長、音階を配列化する\r\n    // テンポとゲートタイムは、結合前の指定値を採用する\r\n    let tmpAry = [];\r\n    for (let loop = 0; loop < toneAry.length; ++loop) {\r\n      let rtn = {\r\n        t: toneAry[loop].t,\r\n        q: toneAry[loop].q,\r\n        v: [],\r\n        p: [],\r\n        o: [],\r\n        l: [],\r\n        m: [],\r\n        tn: [],\r\n      };\r\n      if (toneAry[loop].j === 1) {\r\n        // ＆記号あり、前要素からの延長\r\n        if (0 < tmpAry.length) {\r\n          rtn = tmpAry[tmpAry.length - 1];\r\n          rtn.v.push(toneAry[loop].v);\r\n          rtn.p.push(toneAry[loop].p);\r\n          rtn.o.push(toneAry[loop].o);\r\n          rtn.l.push(toneAry[loop].l);\r\n          rtn.m.push(toneAry[loop].m);\r\n          rtn.tn.push(toneAry[loop].tn);\r\n        } else {\r\n          rtn.v.push(toneAry[loop].v);\r\n          rtn.p.push(toneAry[loop].p);\r\n          rtn.o.push(toneAry[loop].o);\r\n          rtn.l.push(toneAry[loop].l);\r\n          rtn.m.push(toneAry[loop].m);\r\n          rtn.tn.push(toneAry[loop].tn);\r\n          tmpAry.push(rtn);\r\n        }\r\n      } else {\r\n        // ＆記号なし、新要素として追加\r\n        rtn.v.push(toneAry[loop].v);\r\n        rtn.p.push(toneAry[loop].p);\r\n        rtn.o.push(toneAry[loop].o);\r\n        rtn.l.push(toneAry[loop].l);\r\n        rtn.m.push(toneAry[loop].m);\r\n        rtn.tn.push(toneAry[loop].tn);\r\n        tmpAry.push(rtn);\r\n      }\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // デバッグログ\r\n    tmpAry.forEach((x) => {\r\n      console.log(`T${(\"   \" + x.t.toString()).slice(-3)} Q[${x.q}] V[${x.v}] P[${x.p}] O[${x.o}][${x.tn}] L[${x.l}] LFO[${x.m}]`);\r\n    });\r\n    console.log(\"-\".repeat(40));\r\n\r\n    // -------------------------------------------------------------------------\r\n    // パース結果をパート配列へ\r\n    let part = {};\r\n    part.toneAry = tmpAry;\r\n    parser_result.push(part);\r\n  });\r\n  return parser_result;\r\n};\r\n\r\nexport { parser };\r\n","// =============================================================================\r\n// play.js\r\n// Copyright © 2021- gaku.iwa All Rights Reserved.\r\n// =============================================================================\r\nimport { assemble } from \"./assemble.js\";\r\nimport { parser } from \"./parser.js\";\r\n\r\n// -----------------------------------------------------------------------------\r\n// MML再生（mml配列インデックス指定）\r\nconst play = (idx) => {\r\n  if (mml_data.mml.length - 1 < idx) return;\r\n  let val = mml_data.mml[idx].part || ``;\r\n  if (val === ``) return;\r\n  return assemble(parser(val));\r\n};\r\n\r\nexport { play };\r\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","toSEC","tempo","length","toHz","num","Math","pow","nn","parserLFO","strParam","def_gatetime","rtn","type","v_gateTime","v_depth","v_speed","t_gateTime","t_depth","t_speed","ary","split","Number","speed","depth","ln","includes","tm","replace","assemble","parse_result","aux","AudioContext","dst","destination","ctx","context","tm_start","currentTime","forEach","part","osc","createOscillator","vol","createGain","pan","createStereoPanner","Timing","v_dep","gain","connect","frequency","v_lfo","t_dep","t_lfo","toneAry","tn","fullTime","gateTime","setValueAtTime","q","l","t","subTiming","subgateTime","idx","val_vol","cos","v","PI","val_pan","p","freq","lfo_param","m","tmp_depth","sin","linearRampToValueAtTime","exponentialRampToValueAtTime","start","stop","push","x","searchCTRL","chr","def","index","i","ctrl","param","convert","max","min","j","splice","searchLFO","len","toString","tone","slice","parser","mml_part","parser_result","mml","tmp","dmy","ctrlAry","Array","item","toLowerCase","tmpAry","loop","console","log","repeat","play","mml_data","val"],"sourceRoot":""}